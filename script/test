#!/usr/bin/php5
<? # vim: ft=php

  require dirname(__FILE__).'/../config/environment.php';
  require LIB.'tests.php';

  $logger->level = LOG_DISABLED;

  $tests = GLOB(TEST.'*');
  $tests = array_filter($tests, is_dir);
  $tests = array_map(basename, $tests);

  if (empty($argv[1])) {
    $dirs = $tests;
    foreach ($dirs as $i => $dir) {
      if ($dir == 'framework') {
         unset($dirs[$i]);
      }
    }
  } else {
    $dirs = array_slice($argv, 1);
    foreach ($dirs as $dir) {
      if (!in_array($dir, $tests) and !is_file($dir)) {
        print "Usage: $argv[0] [";
        print implode("|", $tests);
        print "]\n";
        exit(255);
      }
    }
  }

  print "\n";
  array_map(run_tests, (array) $dirs);

?>
