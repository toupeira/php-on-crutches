#!/usr/bin/php5
<? # vim: ft=php

  require_once dirname(__FILE__).'/../config/environment.php';
  require_once LIB.'tests.php';

  $logger->level = LOGGER_DISABLED;

  $tests = GLOB(TEST.'*');
  $tests = array_filter($tests, is_dir);
  $tests = array_map(basename, $tests);
  array_remove($tests, 'fixtures');

  if (empty($argv[1])) {
    $paths = $tests;
    array_remove($paths, 'framework');
  } else {
    $paths = array_slice($argv, 1);
    foreach ($paths as $path) {
      if (!in_array($path, $tests) and !is_file($path)) {
        print "Usage: $argv[0] [";
        print implode("|", $tests);
        print "]\n";
        exit(255);
      }
    }
  }

  print "\n";
  array_map(run_tests, array_unique((array) $paths));

?>
